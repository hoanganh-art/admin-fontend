<!DOCTYPE html>
<html>
<head>
    <title>Debug API Response</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #333; }
        .section { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        pre { 
            background: #f9f9f9; 
            padding: 15px; 
            border-left: 4px solid #007bff;
            overflow-x: auto;
            font-size: 12px;
        }
        .json-key { color: #881391; font-weight: bold; }
        .json-string { color: #d73a49; }
        .json-number { color: #005cc5; }
        button { 
            background: #007bff; 
            color: white; 
            padding: 10px 20px; 
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table th, table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        table th { background: #f5f5f5; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç API Response Debugger</h1>
        
        <div class="section">
            <h2>Test Buttons</h2>
            <button onclick="testBasicAPI()">Test /products</button>
            <button onclick="testWithFilters()">Test /products?page=1&per_page=12</button>
            <button onclick="testStats()">Test /products/stats</button>
        </div>

        <div id="status" class="section"></div>
        
        <div class="section">
            <h2>Full Response</h2>
            <pre id="fullResponse">Click a button to test API...</pre>
        </div>

        <div class="section">
            <h2>Response Analysis</h2>
            <div id="analysis"></div>
        </div>

        <div class="section">
            <h2>Data Preview</h2>
            <div id="preview"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = "http://127.0.0.1:6346/api";

        async function testBasicAPI() {
            await testEndpoint(`${API_BASE_URL}/products`, "Basic /products");
        }

        async function testWithFilters() {
            await testEndpoint(`${API_BASE_URL}/products?page=1&per_page=12`, "With Filters");
        }

        async function testStats() {
            await testEndpoint(`${API_BASE_URL}/products/stats`, "Stats");
        }

        async function testEndpoint(url, title) {
            const status = document.getElementById('status');
            const fullResponse = document.getElementById('fullResponse');
            const analysis = document.getElementById('analysis');
            const preview = document.getElementById('preview');

            try {
                status.innerHTML = `<div class="status warning">‚è≥ Testing: ${title}...</div>`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                const data = await response.json();

                // Full response
                fullResponse.textContent = JSON.stringify(data, null, 2);

                // Analysis
                let analysisHTML = `<h3>Endpoint: ${url}</h3>`;
                analysisHTML += `<table>`;
                analysisHTML += `<tr><th>Property</th><th>Value</th></tr>`;
                analysisHTML += `<tr><td>HTTP Status</td><td>${response.status} ${response.statusText}</td></tr>`;
                analysisHTML += `<tr><td>Data Type</td><td>${Array.isArray(data) ? 'ARRAY' : typeof data}</td></tr>`;
                analysisHTML += `<tr><td>Has 'success'</td><td>${'success' in data ? data.success : 'N/A'}</td></tr>`;
                analysisHTML += `<tr><td>Has 'message'</td><td>${'message' in data ? data.message : 'N/A'}</td></tr>`;
                analysisHTML += `<tr><td>Has 'data'</td><td>${'data' in data ? 'YES' : 'NO'}</td></tr>`;

                if (data.data) {
                    analysisHTML += `<tr><td>data type</td><td>${Array.isArray(data.data) ? 'ARRAY' : typeof data.data}</td></tr>`;
                    
                    if (Array.isArray(data.data)) {
                        analysisHTML += `<tr><td>data.length</td><td>${data.data.length}</td></tr>`;
                        if (data.data.length > 0) {
                            analysisHTML += `<tr><td>First item keys</td><td>${Object.keys(data.data[0]).join(', ')}</td></tr>`;
                        }
                    } else if (typeof data.data === 'object') {
                        analysisHTML += `<tr><td>data keys</td><td>${Object.keys(data.data).join(', ')}</td></tr>`;
                        
                        if (data.data.data) {
                            analysisHTML += `<tr><td>data.data type</td><td>${Array.isArray(data.data.data) ? 'ARRAY' : typeof data.data.data}</td></tr>`;
                            if (Array.isArray(data.data.data)) {
                                analysisHTML += `<tr><td>data.data.length</td><td>${data.data.data.length}</td></tr>`;
                                if (data.data.data.length > 0) {
                                    analysisHTML += `<tr><td>First item keys</td><td>${Object.keys(data.data.data[0]).join(', ')}</td></tr>`;
                                }
                            }
                        }
                    }
                }

                analysisHTML += `</table>`;
                analysis.innerHTML = analysisHTML;

                // Preview
                let previewHTML = '<h3>Data Preview</h3>';
                let previewData = null;

                if (Array.isArray(data)) {
                    previewData = data;
                } else if (data.data && Array.isArray(data.data)) {
                    previewData = data.data;
                } else if (data.data && data.data.data && Array.isArray(data.data.data)) {
                    previewData = data.data.data;
                }

                if (previewData && previewData.length > 0) {
                    previewHTML += `<p>Found ${previewData.length} items. Showing first 3:</p>`;
                    previewHTML += '<table>';
                    previewHTML += '<tr>' + Object.keys(previewData[0]).slice(0, 5).map(k => `<th>${k}</th>`).join('') + '</tr>';
                    
                    for (let i = 0; i < Math.min(3, previewData.length); i++) {
                        const item = previewData[i];
                        const keys = Object.keys(item).slice(0, 5);
                        previewHTML += '<tr>' + keys.map(k => `<td>${String(item[k]).substring(0, 50)}</td>`).join('') + '</tr>';
                    }
                    previewHTML += '</table>';
                } else {
                    previewHTML += '<p>No array data found</p>';
                }

                preview.innerHTML = previewHTML;

                status.innerHTML = `<div class="status success">‚úÖ Success! Response received</div>`;

            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                fullResponse.textContent = 'ERROR: ' + error.message;
                analysis.innerHTML = '';
                preview.innerHTML = '';
            }
        }
    </script>
</body>
</html>
